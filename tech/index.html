<!doctype html>
<html lang="ru">
<head>
    <!--
        CITE:
        The following 2 meta tags *must* come first in the <head>
        to consistently ensure proper document rendering.
        Any other head element should come *after* these tags.
    -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<!--<divider>==========================================< ʕ⊙ᴥ⊙ʔ >-->

    <title>Code</title>
    <meta name="description" content="Опера в коде: Долина индекса — Сценарий для браузеров, написанный на ECMAScript 2015. В начале сюжета: рождение мира, подключение функций, выращивание контента..." />
    <meta name="author" content="ZL" />
    <meta name="date" content="2018.6.19" />

<!--<divider>==========================================< ʕ⊙ᴥ⊙ʔ >-->

    <!--
        ОРКЕСТРОМ ДИРИЖИРУЕТ БРАУЗЕР
    -->

    <!-- Презентация музыкантов -->

    <!-- babel, конвертирует код ECMAScript в обычный javascript для браузера -->
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

    <!-- vue, отдаёт команды визуальным декорациям -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2.5.16/dist/vue.js"></script>

    <!-- специальный переводчик для браузеров от microsoft -->
    <meta http-equiv="x-ua-compatible" content="ie=edge" />

<!--<divider>==========================================< ʕ⊙ᴥ⊙ʔ >-->

    <!--
        ХУДОЖЕСТВЕННОЕ ОФОРМЛЕНИЕ: GeneralArtist.css
        описывает облик html декораций
    -->
    <link href="world/GeneralArtist.css" rel="stylesheet"  media="all" />

    <!--
        СЦЕНАРИЙ: Chromosome.js
        в файле описан мир в момент рождения
    -->
    <script src="world/Chromosome.js"></script>

    <!--
        САМЫЙ ГЛАВНЫЙ: GeneralDirector.js
        запускает ангелов, которые следят за процессом
    -->
    <script src="world/GeneralDirector.js"></script>

<!--<divider>==========================================< ʕ⊙ᴥ⊙ʔ >-->


</head>

<!-- В зале гаснет свет, открывается BODY -->

<body>

<!--
    Визуальные декорации построены внутри html тега с классом WorldMap
-->

<main class="WorldMap">
    
</main>

<!-- Начинается сюжет в коде -->

<script type="text/babel">

/*  ****************************************************************************
    ГЛАВА 1
    Рождение короля
    **************************************************************************** */

// В этом мире правит король World

function KingOfWorld() {

    // Описание короля

    this.chromosome = false;
    this.name = 'NewbornWorld'; // имя - признак существования
    this.age = 0;                // возраст - признак видимости, 0=невидимый

};

// Рождение короля по имени World

let World = new KingOfWorld();

/*  ****************************************************************************
    ГЛАВА 2
    Подготовка к коронации и церемония
    **************************************************************************** */
    
// Мистер Коронация описывает пошаговый регламент коронации.
// Коронация генерирует белый шум в радиоэфире в случае успешной коронации.

World.mrCoronation = function() {

    // #CoronationRule.1 Рождение принцев внутри короля
        
    this
        .mrMitosis('Evolution', PrinceOfEvolution)
        .mrMitosis('Geo', PrinceOfGeography)
        .mrMitosis('City', PrincessOfCity)
        ;

    // #CoronationRule.2 Принятие хромосомы

    const chromosome = new WorldChromosome(); // Выделяется хромосома.
    this.Evolution.ApplyChromosome(chromosome); // Старший принц Evolution применяет хромосому на короля

    // #CoronationRule.3 конец коронации

    Radio.r('White noise! Coronation!',{world:this});
    return this;
}

// В этом мире королю помогают принцы.
// Их несколько, у каждого свои конкретные обязанности.
// Мистер Митоз во время коронации присваивает принцу имя, регистрирует и привязывает к королю.

World.registered_kidnames = [];
World.mrMitosis = function(name,role) {
    this[name] = new role(World);
    this.registered_kidnames.push(name);
    return this;
};

// PrinceOfEvolution отвечает за процессы развития

function PrinceOfEvolution(world) {

    this.world = world;
    
    this.Welcome = function() {
        Radio.m('Welcome Evolution the PrinceOfEvolution!');
        return this;
    };

    this.Aging = function() {
        this.world.age++
        return this;
    };

    this.ApplyChromosome = function(chromosome) {
        this.world.chromosome = chromosome;
        const wDNA = chromosome.worldDNA;
        this.world.name = wDNA.name;
        this.world.age = wDNA.age;
        return this;
    };

};

// PrinceOfGeography хранит географическую информацию и рисует её на экране

function PrinceOfGeography(world) {

    this.world = world;
    
    this.Welcome = function() {
        Radio.m('Welcome Geo the PrinceOfGeography!');
        return this;
    };

};

// PrincessOfCity — представитель юзера.
// Принцесса хранит богатства, контролирует производство и реализацию произведённого.

function PrincessOfCity(world) {

    this.world = world;    
    this.name = 'index_city';
    
    this.Welcome = function() {
        Radio.m('Welcome City the PrincessOfCity!');
        return this;
    };
    
    // Свадьба принцессы — это единение с юзером.
    // Во время свадьбы принцесса меняет имя.
    
    this.Marriage = function(new_passport) {
        this.name = new_passport.name;
        return this;
    };
    
}


// После коронации все принцы приглашаются на вечеринку.
// Во время приглашения принцы призывают собственных лордов.
// Запускают жизненные процессы и приходят на вечеринку готовые к работе.
// После вечеринки весь мир готов к новым приключениям

World.mrWelcomeParty = function() {
    for ( let everyone in this.registered_kidnames )
        this[this.registered_kidnames[everyone]].Welcome();
    Radio.r('Welcome party completed!',{guests:this.registered_kidnames,world:this});
    return this;
};


// Церемония коронации

World
    .mrCoronation()
    .mrWelcomeParty()
    ;


    
    
Radio.pause();
Radio.d('Last World',World);
Radio.pause();

// ============================================================== END OF THE WORLD




// Lands занимаются географием местности
// 
// - На землях стоят Landmarks, производят события и ресурсы

// Рождение принцев внутри короля


//Radio.d('Kids are born', World);

//
/*
    // #CoronationRule.2 Приглашение принцев
    // Во время приглашения принцы призывают собственных лордов
    // И приходят в статусе «готов работать»
    
    // Публичное общение с королём

    this.Welcome = function() {
        Radio.m('Welcome '+this.name+' the KingOfWorld!');
        return this;
    };
    
*/

</script>


<div id="BabelOutput"></div>
<!-- Your custom script here -->
<script type="text/babel">
// welcome, babel
const getMessage = () => "Babel, welcome!";
document.getElementById('BabelOutput').innerHTML = getMessage();
// welcome, vue
const vueWorldMap = new Vue({
  el: '.WorldMap'
});
</script>


<!-- =================================================== [CONTENT END] -->
<!-- =================================================== ʕ⊙ᴥ⊙ʔ  -->



<!-- =================================================== ʕ⊙ᴥ⊙ʔ  -->
<!-- =================================================== [GROUND] -->


</body>
</html>
